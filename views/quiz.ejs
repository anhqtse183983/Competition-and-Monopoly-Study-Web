<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kiá»ƒm tra kiáº¿n thá»©c</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Noto+Serif:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/public/css/style.css">
  <link rel="stylesheet" href="/public/css/quiz.css">
</head>

<body>
  <header class="site-header">
    <div class="container header-row">
      <div class="brand-text">
        <div class="title">BÃ i kiá»ƒm tra</div>
      </div>
      <a href="/" class="btn-back">â† Quay láº¡i</a>
      <button class="theme-toggle-btn" id="themeToggle">ğŸŒ</button>
    </div>
  </header>

  <main class="container main" id="quiz-container">
    <section class="group-section" id="quiz">
      <div class="group-header">
        <div>
          <h2 class="group-title">Kiá»ƒm tra kiáº¿n thá»©c</h2>
          <p class="group-desc">Chá»n Ä‘Ã¡p Ã¡n Ä‘Ãºng nháº¥t cho má»—i cÃ¢u há»i.</p>
        </div>
      </div>

      <div id="question-box" class="card quiz-card">
        <div id="question-progress" class="quiz-progress">
          CÃ¢u <span id="question-number">1</span> / <span id="total-questions"><%= quizData.length %></span>
        </div>
        <h3 id="question-text" class="quiz-question">CÃ¢u há»i sáº½ hiá»ƒn thá»‹ á»Ÿ Ä‘Ã¢y</h3>

        <form id="answers" class="quiz-options">
          <label><input type="radio" name="answer" value="A"> <span id="a"></span></label>
          <label><input type="radio" name="answer" value="B"> <span id="b"></span></label>
          <label><input type="radio" name="answer" value="C"> <span id="c"></span></label>
          <label><input type="radio" name="answer" value="D"> <span id="d"></span></label>
        </form>

        <button id="submit" class="btn btn-primary">Gá»­i</button>

        <div id="result" class="quiz-result"></div>

        <div id="controls" class="quiz-controls">
          <button id="retry" class="btn btn-secondary">LÃ m láº¡i</button>
          <button id="next" class="btn btn-primary">Tiáº¿p tá»¥c</button>
        </div>
      </div>
    </section>
  </main>

  <script>
    const questions = JSON.parse(`<%- JSON.stringify(quizData) %>`);
    let current = 0;
    let score = 0;
  
    const qText = document.getElementById("question-text");
    const result = document.getElementById("result");
    const controls = document.getElementById("controls");
    const qNumber = document.getElementById("question-number");
  
    function loadQuestion() {
      const q = questions[current];
      qText.textContent = q.text;
      document.getElementById("a").textContent = q.options.A;
      document.getElementById("b").textContent = q.options.B;
      document.getElementById("c").textContent = q.options.C;
      document.getElementById("d").textContent = q.options.D;
      document.querySelectorAll('input[name="answer"]').forEach(i => i.checked = false);
      result.textContent = "";
      result.classList.remove("correct", "incorrect");
      controls.style.display = "none";
      qNumber.textContent = current + 1;
    }
  
    document.getElementById("submit").onclick = (e) => {
      e.preventDefault();
      const selected = document.querySelector('input[name="answer"]:checked');
      if (!selected) return alert("HÃ£y chá»n má»™t Ä‘Ã¡p Ã¡n!");
  
      const q = questions[current];
      if (selected.value === q.correct) {
        result.textContent = "âœ… ChÃ­nh xÃ¡c!";
        result.classList.add("correct");
        score++;
      } else {
        result.textContent = `âŒ Sai! ${q.explanation}`;
        result.classList.add("incorrect");
      }
      controls.style.display = "flex";
    };
  
    document.getElementById("retry").onclick = () => loadQuestion();
  
    document.getElementById("next").onclick = () => {
      current++;
      if (current < questions.length) {
        loadQuestion();
      } else {
        // hiá»ƒn thá»‹ Ä‘iá»ƒm cuá»‘i cÃ¹ng
        const total = questions.length;
        qText.innerHTML = `ğŸ‰ Báº¡n Ä‘Ã£ hoÃ n thÃ nh bÃ i kiá»ƒm tra!<br><br>Äiá»ƒm cá»§a báº¡n: <strong>${score} / ${total}</strong>`;
        document.getElementById("answers").style.display = "none";
        document.getElementById("submit").style.display = "none";
        controls.style.display = "none";
        result.textContent = "";
        qNumber.textContent = "âœ“";
  
        // thÃªm hiá»‡u á»©ng hoáº·c thÃ´ng Ä‘iá»‡p tÃ¹y chá»n
        const msg = document.createElement("p");
        msg.className = "quiz-final-message";
        msg.innerHTML = score === total
          ? "ğŸŒŸ Xuáº¥t sáº¯c! Báº¡n Ä‘Ã£ tráº£ lá»i Ä‘Ãºng táº¥t cáº£!"
          : score >= total * 0.7
            ? "ğŸ‘ Ráº¥t tá»‘t! Báº¡n Ä‘Ã£ hiá»ƒu khÃ¡ rÃµ bÃ i há»c."
            : "ğŸ’ª HÃ£y Ã´n láº¡i pháº§n lÃ½ thuyáº¿t vÃ  thá»­ láº¡i nhÃ©!";
        document.getElementById("quiz").appendChild(msg);
      }
    };
  
    loadQuestion();
  </script>
  <script>  
    const toggleBtn = document.getElementById("themeToggle");
    const body = document.body;
  
    if (localStorage.getItem("theme") === "dark") {
      body.classList.add("dark-mode");
      toggleBtn.textContent = "ğŸŒ™";
    }
  
    toggleBtn.addEventListener("click", () => {
      body.classList.toggle("dark-mode");
      const isDark = body.classList.contains("dark-mode");
      toggleBtn.textContent = isDark ? "ğŸŒ™" : "ğŸŒ";
      localStorage.setItem("theme", isDark ? "dark" : "light");
    });
    </script>
</body>
</html>
