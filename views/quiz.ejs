<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ki·ªÉm tra ki·∫øn th·ª©c</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Noto+Serif:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/public/css/style.css">
  <link rel="stylesheet" href="/public/css/quiz.css">
</head>

<body>
  <header class="site-header">
    <div class="container header-row">
      <div class="brand-text">
        <div class="title">B√†i ki·ªÉm tra</div>
      </div>
      <a href="/" class="btn-back">‚Üê Quay l·∫°i</a>
    </div>
  </header>

  <main class="container main" id="quiz-container">
    <section class="group-section" id="quiz">
      <div class="group-header">
        <div class="group-index" id="question-number">1</div>
        <div>
          <h2 class="group-title">Ki·ªÉm tra ki·∫øn th·ª©c</h2>
          <p class="group-desc">Ch·ªçn ƒë√°p √°n ƒë√∫ng nh·∫•t cho m·ªói c√¢u h·ªèi.</p>
        </div>
      </div>

      <div id="question-box" class="card quiz-card">
        <h3 id="question-text" class="quiz-question">C√¢u h·ªèi s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y</h3>

        <form id="answers" class="quiz-options">
          <label><input type="radio" name="answer" value="A"> <span id="a"></span></label>
          <label><input type="radio" name="answer" value="B"> <span id="b"></span></label>
          <label><input type="radio" name="answer" value="C"> <span id="c"></span></label>
          <label><input type="radio" name="answer" value="D"> <span id="d"></span></label>
        </form>

        <button id="submit" class="btn btn-primary">G·ª≠i</button>

        <div id="result" class="quiz-result"></div>

        <div id="controls" class="quiz-controls">
          <button id="retry" class="btn btn-secondary">L√†m l·∫°i</button>
          <button id="next" class="btn btn-primary">Ti·∫øp t·ª•c</button>
        </div>
      </div>
    </section>
  </main>

  <script>
    const questions = JSON.parse(`<%- JSON.stringify(quizData) %>`);
    let current = 0;
    let score = 0;
  
    const qText = document.getElementById("question-text");
    const result = document.getElementById("result");
    const controls = document.getElementById("controls");
    const qNumber = document.getElementById("question-number");
  
    function loadQuestion() {
      const q = questions[current];
      qText.textContent = q.text;
      document.getElementById("a").textContent = q.options.A;
      document.getElementById("b").textContent = q.options.B;
      document.getElementById("c").textContent = q.options.C;
      document.getElementById("d").textContent = q.options.D;
      document.querySelectorAll('input[name="answer"]').forEach(i => i.checked = false);
      result.textContent = "";
      result.classList.remove("correct", "incorrect");
      controls.style.display = "none";
      qNumber.textContent = current + 1;
    }
  
    document.getElementById("submit").onclick = (e) => {
      e.preventDefault();
      const selected = document.querySelector('input[name="answer"]:checked');
      if (!selected) return alert("H√£y ch·ªçn m·ªôt ƒë√°p √°n!");
  
      const q = questions[current];
      if (selected.value === q.correct) {
        result.textContent = "‚úÖ Ch√≠nh x√°c!";
        result.classList.add("correct");
        score++;
      } else {
        result.textContent = `‚ùå Sai! ${q.explanation}`;
        result.classList.add("incorrect");
      }
      controls.style.display = "flex";
    };
  
    document.getElementById("retry").onclick = () => loadQuestion();
  
    document.getElementById("next").onclick = () => {
      current++;
      if (current < questions.length) {
        loadQuestion();
      } else {
        // hi·ªÉn th·ªã ƒëi·ªÉm cu·ªëi c√πng
        const total = questions.length;
        qText.innerHTML = `üéâ B·∫°n ƒë√£ ho√†n th√†nh b√†i ki·ªÉm tra!<br><br>ƒêi·ªÉm c·ªßa b·∫°n: <strong>${score} / ${total}</strong>`;
        document.getElementById("answers").style.display = "none";
        document.getElementById("submit").style.display = "none";
        controls.style.display = "none";
        result.textContent = "";
        qNumber.textContent = "‚úì";
  
        // th√™m hi·ªáu ·ª©ng ho·∫∑c th√¥ng ƒëi·ªáp t√πy ch·ªçn
        const msg = document.createElement("p");
        msg.className = "quiz-final-message";
        msg.innerHTML = score === total
          ? "üåü Xu·∫•t s·∫Øc! B·∫°n ƒë√£ tr·∫£ l·ªùi ƒë√∫ng t·∫•t c·∫£!"
          : score >= total * 0.7
            ? "üëè R·∫•t t·ªët! B·∫°n ƒë√£ hi·ªÉu kh√° r√µ b√†i h·ªçc."
            : "üí™ H√£y √¥n l·∫°i ph·∫ßn l√Ω thuy·∫øt v√† th·ª≠ l·∫°i nh√©!";
        document.getElementById("quiz").appendChild(msg);
      }
    };
  
    loadQuestion();
  </script>
  
</body>
</html>
